{"version":3,"file":"sanity-plugin-bynder-input.cjs.development.js","sources":["../src/utils.ts","../src/components/VideoPlayer.tsx","../src/components/BynderInput.tsx","../src/components/BynderDiff.tsx","../src/schema/bynder.asset.ts"],"sourcesContent":["const url =\n  'https://d8ejoa1fys2rk.cloudfront.net/5.0.5/modules/compactview/bynder-compactview-2-latest.js';\n\nexport function loadBynder(callback: () => void) {\n  const existingScript = document.getElementById('bynder');\n  if (!existingScript) {\n    const script = document.createElement('script');\n    script.src = url;\n    script.id = 'bynder';\n    document.body.appendChild(script);\n    script.onload = () => {\n      if (callback) {\n        return callback();\n      }\n      return true;\n    };\n  }\n  if (existingScript && callback) {\n    return callback();\n  }\n  return true;\n}\n","import React from 'react';\nimport videojs, { VideoJsPlayer, VideoJsPlayerOptions } from 'video.js';\n\nexport default class VideoPlayer extends React.Component<\n  VideoJsPlayerOptions,\n  any\n> {\n  videoNode?: HTMLVideoElement;\n  player?: VideoJsPlayer;\n  componentDidMount() {\n    this.player = videojs(this.videoNode, this.props);\n  }\n\n  componentWillUnmount() {\n    if (this.player) {\n      this.player.dispose();\n    }\n  }\n\n  render() {\n    return (\n      <div>\n        <link\n          href=\"https://vjs.zencdn.net/7.8.4/video-js.css\"\n          rel=\"stylesheet\"\n        />\n        <div data-vjs-player style={{ marginBottom: '16px' }}>\n          <video\n            className=\"video-js vjs-16-9 vjs-big-play-centered\"\n            ref={node => {\n              if (node) {\n                this.videoNode = node;\n              }\n            }}\n          ></video>\n        </div>\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport { loadBynder } from '../utils';\nimport PatchEvent, { set, unset } from '@sanity/form-builder/PatchEvent';\nimport pluginConfig from 'config:bynder-input';\nimport ButtonGrid from 'part:@sanity/components/buttons/button-grid';\nimport Button from 'part:@sanity/components/buttons/default';\nimport Fieldset from 'part:@sanity/components/fieldsets/default';\nimport VideoPlayer from './VideoPlayer';\n\ndeclare global {\n  interface Window {\n    BynderCompactView: any;\n  }\n}\n\ntype Props = {\n  type: Record<string, any>;\n  onChange: any;\n  value: Record<string, any>;\n  level: number;\n  readOnly: boolean;\n  markers: any[];\n};\n\nconst BynderInput = (props: Props) => {\n  const removeValue = () => {\n    const { onChange } = props;\n    onChange(PatchEvent.from([unset()]));\n  };\n\n  const getPreviewUrl = (asset: Props['type']) => {\n    switch (asset.type) {\n      case 'VIDEO':\n        return asset.previewUrls[0];\n      default:\n        return asset.files.webImage.url;\n    }\n  };\n\n  const getVideoUrl = (asset: Props['type']) => {\n    if (asset.type === 'VIDEO') {\n      // if original asset is available (public videos only) use that if not fall back to the preview url\n      return asset.files?.original?.url ?? asset.previewUrls[0];\n    }\n    return null;\n  };\n\n  const getAspectRatio = (dimensions: {\n    width: number;\n    height: number;\n  }): number => dimensions.height / dimensions.width;\n\n  const openMediaSelector = () => {\n    const { onChange, type, value } = props;\n    const onSuccess = (assets: any[]) => {\n      const asset = assets[0];\n      const webImage = asset.files.webImage;\n\n      const aspectRatio = getAspectRatio({\n        width: webImage.width,\n        height: webImage.height,\n      });\n      onChange(\n        PatchEvent.from([\n          set({\n            _key: value?._key,\n            _type: type.name,\n            id: asset.id,\n            name: asset.name,\n            databaseId: asset.databaseId,\n            type: asset.type,\n            previewUrl: getPreviewUrl(asset),\n            previewImg: webImage.url,\n            datUrl: asset.files.transformBaseUrl?.url,\n            videoUrl: getVideoUrl(asset),\n            description: asset.description,\n            aspectRatio,\n          }),\n        ])\n      );\n    };\n\n    const options: Record<string, any> = {\n      language: pluginConfig.language || 'en_US',\n      defaultDomain: pluginConfig.portalDomain,\n      theme: {\n        colorPrimary: '#156dff',\n        colorButtonPrimary: '#156dff',\n      },\n      mode: 'SingleSelectFile',\n      onSuccess,\n    };\n\n    const { assetTypes } = type.options;\n    if (assetTypes) {\n      options.assetTypes = assetTypes;\n    }\n\n    loadBynder(() => {\n      window.BynderCompactView.open(options);\n    });\n  };\n\n  const { value, type, markers, level, readOnly } = props;\n\n  let preview;\n  if (value) {\n    if (value.type === 'VIDEO') {\n      preview = (\n        <VideoPlayer\n          controls\n          poster={value.previewImg}\n          sources={[{ src: value.previewUrl }]}\n        />\n      );\n    }\n    if (value.type === 'IMAGE') {\n      preview = (\n        <img\n          alt=\"preview\"\n          src={value.previewUrl}\n          style={{ maxWidth: '100%', height: 'auto' }}\n        />\n      );\n      // TODO: Add preview for document / audio types and empty state\n    }\n  }\n\n  return (\n    <Fieldset\n      markers={markers}\n      //presence={presence.filter(item => item.path[0] === '$' || isInside.includes(item.identity))}\n      legend={type.title}\n      description={type.description}\n      level={level}\n    >\n      <div style={{ textAlign: 'center' }}>{preview}</div>\n\n      <ButtonGrid align=\"start\">\n        <Button\n          disabled={readOnly}\n          inverted\n          title=\"Select an asset\"\n          kind=\"default\"\n          onClick={openMediaSelector}\n        >\n          Browse\n        </Button>\n        <Button\n          disabled={readOnly || !value}\n          color=\"danger\"\n          inverted\n          title=\"Remove asset\"\n          onClick={removeValue}\n        >\n          Remove\n        </Button>\n      </ButtonGrid>\n    </Fieldset>\n  );\n};\n\nexport default BynderInput;\n","import React from 'react';\nimport { DiffFromTo, SchemaType } from '@sanity/field/diff';\nimport styles from './ImagePreview.css';\n\ntype ComponentProps = {\n  value: any;\n};\n\nfunction Component({ value }: ComponentProps) {\n  if (value && value.previewUrl) {\n    return (\n      <div>\n        <img alt=\"preview\" src={value.previewUrl} style={{ width: '100%' }} />\n      </div>\n    );\n  }\n  return (\n    <div className={styles.noImage}>\n      <div>(no image)</div>\n    </div>\n  );\n}\n\ntype DiffProps = {\n  diff: any;\n  schemaType: SchemaType;\n};\n\nconst BynderDiff = ({ diff, schemaType }: DiffProps) => {\n  return (\n    <DiffFromTo\n      diff={diff}\n      schemaType={schemaType}\n      previewComponent={Component}\n    />\n  );\n};\n\nexport default BynderDiff;\n","import BynderInput from '../components/BynderInput';\nimport BynderDiff from '../components/BynderDiff';\n\nexport default {\n  name: 'bynder.asset',\n  type: 'object',\n  title: 'Bynder Asset',\n  fields: [\n    {\n      type: 'string',\n      name: 'id',\n    },\n    {\n      type: 'string',\n      name: 'name',\n    },\n    {\n      type: 'string',\n      name: 'databaseId',\n    },\n    {\n      type: 'string',\n      name: 'type',\n    },\n    {\n      type: 'string',\n      name: 'previewUrl',\n    },\n    {\n      type: 'string',\n      name: 'previewImg',\n    },\n    {\n      type: 'string',\n      name: 'datUrl',\n    },\n    {\n      type: 'string',\n      name: 'description',\n    },\n    {\n      type: 'number',\n      name: 'aspectRatio',\n    },\n    {\n      type: 'string',\n      name: 'videoUrl',\n    },\n  ],\n  inputComponent: BynderInput,\n  diffComponent: BynderDiff,\n  /*\n  preview: {\n    select: {\n      playbackId: 'asset.playbackId',\n      status: 'asset.status',\n      duration: 'asset.data.duration',\n      thumbTime: 'asset.thumbTime',\n      filename: 'asset.filename'\n    },\n    component: Preview\n  }\n  */\n};\n"],"names":["url","loadBynder","callback","existingScript","document","getElementById","script","createElement","src","id","body","appendChild","onload","VideoPlayer","componentDidMount","player","videojs","videoNode","props","componentWillUnmount","dispose","render","React","href","rel","style","marginBottom","className","ref","node","Component","BynderInput","removeValue","onChange","PatchEvent","from","unset","getPreviewUrl","asset","type","previewUrls","files","webImage","getVideoUrl","original","getAspectRatio","dimensions","height","width","openMediaSelector","value","onSuccess","assets","aspectRatio","set","_key","_type","name","databaseId","previewUrl","previewImg","datUrl","transformBaseUrl","videoUrl","description","options","language","pluginConfig","defaultDomain","portalDomain","theme","colorPrimary","colorButtonPrimary","mode","assetTypes","window","BynderCompactView","open","markers","level","readOnly","preview","controls","poster","sources","alt","maxWidth","Fieldset","legend","title","textAlign","ButtonGrid","align","Button","disabled","inverted","kind","onClick","color","styles","noImage","BynderDiff","diff","schemaType","DiffFromTo","previewComponent","fields","inputComponent","diffComponent"],"mappings":";;;;;;;;;;;;;;;;AAAA,IAAMA,GAAG,GACP,+FADF;SAGgBC,WAAWC;AACzB,MAAMC,cAAc,GAAGC,QAAQ,CAACC,cAAT,CAAwB,QAAxB,CAAvB;;AACA,MAAI,CAACF,cAAL,EAAqB;AACnB,QAAMG,MAAM,GAAGF,QAAQ,CAACG,aAAT,CAAuB,QAAvB,CAAf;AACAD,IAAAA,MAAM,CAACE,GAAP,GAAaR,GAAb;AACAM,IAAAA,MAAM,CAACG,EAAP,GAAY,QAAZ;AACAL,IAAAA,QAAQ,CAACM,IAAT,CAAcC,WAAd,CAA0BL,MAA1B;;AACAA,IAAAA,MAAM,CAACM,MAAP,GAAgB;AACd,UAAIV,QAAJ,EAAc;AACZ,eAAOA,QAAQ,EAAf;AACD;;AACD,aAAO,IAAP;AACD,KALD;AAMD;;AACD,MAAIC,cAAc,IAAID,QAAtB,EAAgC;AAC9B,WAAOA,QAAQ,EAAf;AACD;;AACD,SAAO,IAAP;AACD;;;;;;;;;;;;;;;;;;IClBoBW;;;;;;;;;SAMnBC,oBAAA;AACE,SAAKC,MAAL,GAAcC,OAAO,CAAC,KAAKC,SAAN,EAAiB,KAAKC,KAAtB,CAArB;AACD;;SAEDC,uBAAA;AACE,QAAI,KAAKJ,MAAT,EAAiB;AACf,WAAKA,MAAL,CAAYK,OAAZ;AACD;AACF;;SAEDC,SAAA;;;AACE,WACEC,mBAAA,MAAA,MAAA,EACEA,mBAAA,OAAA;AACEC,MAAAA,IAAI,EAAC;AACLC,MAAAA,GAAG,EAAC;KAFN,CADF,EAKEF,mBAAA,MAAA;;AAAqBG,MAAAA,KAAK,EAAE;AAAEC,QAAAA,YAAY,EAAE;AAAhB;KAA5B,EACEJ,mBAAA,QAAA;AACEK,MAAAA,SAAS,EAAC;AACVC,MAAAA,GAAG,EAAE,aAAAC,IAAI;AACP,YAAIA,IAAJ,EAAU;AACR,UAAA,KAAI,CAACZ,SAAL,GAAiBY,IAAjB;AACD;AACF;KANH,CADF,CALF,CADF;AAkBD;;;EAnCsCP,KAAK,CAACQ;;ACqB/C,IAAMC,WAAW,GAAG,SAAdA,WAAc,CAACb,KAAD;AAClB,MAAMc,WAAW,GAAG,SAAdA,WAAc;QACVC,WAAaf,MAAbe;AACRA,IAAAA,QAAQ,CAACC,mBAAU,CAACC,IAAX,CAAgB,CAACC,gBAAK,EAAN,CAAhB,CAAD,CAAR;AACD,GAHD;;AAKA,MAAMC,aAAa,GAAG,SAAhBA,aAAgB,CAACC,KAAD;AACpB,YAAQA,KAAK,CAACC,IAAd;AACE,WAAK,OAAL;AACE,eAAOD,KAAK,CAACE,WAAN,CAAkB,CAAlB,CAAP;;AACF;AACE,eAAOF,KAAK,CAACG,KAAN,CAAYC,QAAZ,CAAqB1C,GAA5B;AAJJ;AAMD,GAPD;;AASA,MAAM2C,WAAW,GAAG,SAAdA,WAAc,CAACL,KAAD;AAClB,QAAIA,KAAK,CAACC,IAAN,KAAe,OAAnB,EAA4B;AAAA;;AAC1B;AACA,sDAAOD,KAAK,CAACG,KAAb,+CAAO,aAAaG,QAApB,qBAAO,uBAAuB5C,GAA9B,oCAAqCsC,KAAK,CAACE,WAAN,CAAkB,CAAlB,CAArC;AACD;;AACD,WAAO,IAAP;AACD,GAND;;AAQA,MAAMK,cAAc,GAAG,SAAjBA,cAAiB,CAACC,UAAD;AAAA,WAGTA,UAAU,CAACC,MAAX,GAAoBD,UAAU,CAACE,KAHtB;AAAA,GAAvB;;AAKA,MAAMC,iBAAiB,GAAG,SAApBA,iBAAoB;QAChBhB,WAA0Bf,MAA1Be;QAAUM,OAAgBrB,MAAhBqB;QAAMW,QAAUhC,MAAVgC;;AACxB,QAAMC,SAAS,GAAG,SAAZA,SAAY,CAACC,MAAD;;;AAChB,UAAMd,KAAK,GAAGc,MAAM,CAAC,CAAD,CAApB;AACA,UAAMV,QAAQ,GAAGJ,KAAK,CAACG,KAAN,CAAYC,QAA7B;AAEA,UAAMW,WAAW,GAAGR,cAAc,CAAC;AACjCG,QAAAA,KAAK,EAAEN,QAAQ,CAACM,KADiB;AAEjCD,QAAAA,MAAM,EAAEL,QAAQ,CAACK;AAFgB,OAAD,CAAlC;AAIAd,MAAAA,QAAQ,CACNC,mBAAU,CAACC,IAAX,CAAgB,CACdmB,cAAG,CAAC;AACFC,QAAAA,IAAI,EAAEL,KAAF,oBAAEA,KAAK,CAAEK,IADX;AAEFC,QAAAA,KAAK,EAAEjB,IAAI,CAACkB,IAFV;AAGFhD,QAAAA,EAAE,EAAE6B,KAAK,CAAC7B,EAHR;AAIFgD,QAAAA,IAAI,EAAEnB,KAAK,CAACmB,IAJV;AAKFC,QAAAA,UAAU,EAAEpB,KAAK,CAACoB,UALhB;AAMFnB,QAAAA,IAAI,EAAED,KAAK,CAACC,IANV;AAOFoB,QAAAA,UAAU,EAAEtB,aAAa,CAACC,KAAD,CAPvB;AAQFsB,QAAAA,UAAU,EAAElB,QAAQ,CAAC1C,GARnB;AASF6D,QAAAA,MAAM,2BAAEvB,KAAK,CAACG,KAAN,CAAYqB,gBAAd,qBAAE,sBAA8B9D,GATpC;AAUF+D,QAAAA,QAAQ,EAAEpB,WAAW,CAACL,KAAD,CAVnB;AAWF0B,QAAAA,WAAW,EAAE1B,KAAK,CAAC0B,WAXjB;AAYFX,QAAAA,WAAW,EAAXA;AAZE,OAAD,CADW,CAAhB,CADM,CAAR;AAkBD,KA1BD;;AA4BA,QAAMY,OAAO,GAAwB;AACnCC,MAAAA,QAAQ,EAAEC,YAAY,CAACD,QAAb,IAAyB,OADA;AAEnCE,MAAAA,aAAa,EAAED,YAAY,CAACE,YAFO;AAGnCC,MAAAA,KAAK,EAAE;AACLC,QAAAA,YAAY,EAAE,SADT;AAELC,QAAAA,kBAAkB,EAAE;AAFf,OAH4B;AAOnCC,MAAAA,IAAI,EAAE,kBAP6B;AAQnCtB,MAAAA,SAAS,EAATA;AARmC,KAArC;QAWQuB,aAAenC,IAAI,CAAC0B,QAApBS;;AACR,QAAIA,UAAJ,EAAgB;AACdT,MAAAA,OAAO,CAACS,UAAR,GAAqBA,UAArB;AACD;;AAEDzE,IAAAA,UAAU,CAAC;AACT0E,MAAAA,MAAM,CAACC,iBAAP,CAAyBC,IAAzB,CAA8BZ,OAA9B;AACD,KAFS,CAAV;AAGD,GAjDD;;MAmDQf,QAA0ChC,MAA1CgC;MAAOX,OAAmCrB,MAAnCqB;MAAMuC,UAA6B5D,MAA7B4D;MAASC,QAAoB7D,MAApB6D;MAAOC,WAAa9D,MAAb8D;AAErC,MAAIC,OAAJ;;AACA,MAAI/B,KAAJ,EAAW;AACT,QAAIA,KAAK,CAACX,IAAN,KAAe,OAAnB,EAA4B;AAC1B0C,MAAAA,OAAO,GACL3D,mBAAA,CAACT,WAAD;AACEqE,QAAAA,QAAQ;AACRC,QAAAA,MAAM,EAAEjC,KAAK,CAACU;AACdwB,QAAAA,OAAO,EAAE,CAAC;AAAE5E,UAAAA,GAAG,EAAE0C,KAAK,CAACS;AAAb,SAAD;OAHX,CADF;AAOD;;AACD,QAAIT,KAAK,CAACX,IAAN,KAAe,OAAnB,EAA4B;AAC1B0C,MAAAA,OAAO,GACL3D,mBAAA,MAAA;AACE+D,QAAAA,GAAG,EAAC;AACJ7E,QAAAA,GAAG,EAAE0C,KAAK,CAACS;AACXlC,QAAAA,KAAK,EAAE;AAAE6D,UAAAA,QAAQ,EAAE,MAAZ;AAAoBvC,UAAAA,MAAM,EAAE;AAA5B;OAHT,CADF,CAD0B;AAS3B;AACF;;AAED,SACEzB,mBAAA,CAACiE,QAAD;AACET,IAAAA,OAAO,EAAEA;AACT;AACAU,IAAAA,MAAM,EAAEjD,IAAI,CAACkD;AACbzB,IAAAA,WAAW,EAAEzB,IAAI,CAACyB;AAClBe,IAAAA,KAAK,EAAEA;GALT,EAOEzD,mBAAA,MAAA;AAAKG,IAAAA,KAAK,EAAE;AAAEiE,MAAAA,SAAS,EAAE;AAAb;GAAZ,EAAsCT,OAAtC,CAPF,EASE3D,mBAAA,CAACqE,UAAD;AAAYC,IAAAA,KAAK,EAAC;GAAlB,EACEtE,mBAAA,CAACuE,MAAD;AACEC,IAAAA,QAAQ,EAAEd;AACVe,IAAAA,QAAQ;AACRN,IAAAA,KAAK,EAAC;AACNO,IAAAA,IAAI,EAAC;AACLC,IAAAA,OAAO,EAAEhD;GALX,UAAA,CADF,EAUE3B,mBAAA,CAACuE,MAAD;AACEC,IAAAA,QAAQ,EAAEd,QAAQ,IAAI,CAAC9B;AACvBgD,IAAAA,KAAK,EAAC;AACNH,IAAAA,QAAQ;AACRN,IAAAA,KAAK,EAAC;AACNQ,IAAAA,OAAO,EAAEjE;GALX,UAAA,CAVF,CATF,CADF;AAgCD,CAxID;;AChBA,SAASF,SAAT;MAAqBoB,aAAAA;;AACnB,MAAIA,KAAK,IAAIA,KAAK,CAACS,UAAnB,EAA+B;AAC7B,WACErC,mBAAA,MAAA,MAAA,EACEA,mBAAA,MAAA;AAAK+D,MAAAA,GAAG,EAAC;AAAU7E,MAAAA,GAAG,EAAE0C,KAAK,CAACS;AAAYlC,MAAAA,KAAK,EAAE;AAAEuB,QAAAA,KAAK,EAAE;AAAT;KAAjD,CADF,CADF;AAKD;;AACD,SACE1B,mBAAA,MAAA;AAAKK,IAAAA,SAAS,EAAEwE,SAAM,CAACC;GAAvB,EACE9E,mBAAA,MAAA,MAAA,cAAA,CADF,CADF;AAKD;;AAOD,IAAM+E,UAAU,GAAG,SAAbA,UAAa;MAAGC,eAAAA;MAAMC,mBAAAA;AAC1B,SACEjF,mBAAA,CAACkF,eAAD;AACEF,IAAAA,IAAI,EAAEA;AACNC,IAAAA,UAAU,EAAEA;AACZE,IAAAA,gBAAgB,EAAE3E;GAHpB,CADF;AAOD,CARD;;ACzBA,aAAe;AACb2B,EAAAA,IAAI,EAAE,cADO;AAEblB,EAAAA,IAAI,EAAE,QAFO;AAGbkD,EAAAA,KAAK,EAAE,cAHM;AAIbiB,EAAAA,MAAM,EAAE,CACN;AACEnE,IAAAA,IAAI,EAAE,QADR;AAEEkB,IAAAA,IAAI,EAAE;AAFR,GADM,EAKN;AACElB,IAAAA,IAAI,EAAE,QADR;AAEEkB,IAAAA,IAAI,EAAE;AAFR,GALM,EASN;AACElB,IAAAA,IAAI,EAAE,QADR;AAEEkB,IAAAA,IAAI,EAAE;AAFR,GATM,EAaN;AACElB,IAAAA,IAAI,EAAE,QADR;AAEEkB,IAAAA,IAAI,EAAE;AAFR,GAbM,EAiBN;AACElB,IAAAA,IAAI,EAAE,QADR;AAEEkB,IAAAA,IAAI,EAAE;AAFR,GAjBM,EAqBN;AACElB,IAAAA,IAAI,EAAE,QADR;AAEEkB,IAAAA,IAAI,EAAE;AAFR,GArBM,EAyBN;AACElB,IAAAA,IAAI,EAAE,QADR;AAEEkB,IAAAA,IAAI,EAAE;AAFR,GAzBM,EA6BN;AACElB,IAAAA,IAAI,EAAE,QADR;AAEEkB,IAAAA,IAAI,EAAE;AAFR,GA7BM,EAiCN;AACElB,IAAAA,IAAI,EAAE,QADR;AAEEkB,IAAAA,IAAI,EAAE;AAFR,GAjCM,EAqCN;AACElB,IAAAA,IAAI,EAAE,QADR;AAEEkB,IAAAA,IAAI,EAAE;AAFR,GArCM,CAJK;AA8CbkD,EAAAA,cAAc,EAAE5E,WA9CH;AA+Cb6E,EAAAA,aAAa,EAAEP;AA/CF,CAAf;;;;"}